---
import { getCollection, render } from "astro:content";
import Badge from "../../components/Badge.astro";
import Button from "../../components/Button.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const events = await getCollection("events");
  return events.map((event) => ({
    params: { slug: event.slug },
    props: { event }
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);
const eventDateObj = new Date(event.data.date);
const fullDate = new Intl.DateTimeFormat("en-GB", { dateStyle: "full" }).format(eventDateObj);
const day = new Intl.DateTimeFormat("en-GB", { day: "2-digit" }).format(eventDateObj);
const month = new Intl.DateTimeFormat("en-GB", { month: "short" }).format(eventDateObj);
---

<BaseLayout title={event.data.title} description={event.data.description}>
  <article class="surface-panel grid gap-6 p-6 md:p-8">
    <header class="grid gap-4 md:grid-cols-[auto_1fr] md:items-start">
      <div
        aria-label={`Date ${fullDate}`}
        class="grid min-w-[4.2rem] place-items-center rounded-soft border border-brand-aurora/40 bg-brand-aurora/14 px-3 py-2 leading-none"
      >
        <span class="font-heading text-3xl text-text-base">{day}</span>
        <span class="text-xs font-semibold uppercase tracking-[0.14em] text-brand-aurora">{month}</span>
      </div>

      <div class="grid gap-3">
        <div class="flex flex-wrap gap-2">
          <Badge tone="teal">{event.data.category}</Badge>
          <Badge tone="highland">{event.data.town}</Badge>
          {event.data.venue ? <Badge>{event.data.venue}</Badge> : null}
        </div>

        <h1 class="text-4xl md:text-5xl">{event.data.title}</h1>
        <p class="max-w-3xl text-base text-text-muted md:text-lg">{event.data.description}</p>
        <p class="text-sm text-text-subtle">{fullDate}</p>
      </div>
    </header>

    <div class="flex flex-wrap gap-3">
      <Button href="/events" variant="ghost">Back to Events</Button>
      <Button type="button" variant="ghost" disabled={true}>Add to Calendar (Soon)</Button>
      {event.data.externalUrl ? <Button href={event.data.externalUrl}>External Event Page</Button> : null}
    </div>

    <div class="prose-content">
      <Content />
    </div>
  </article>
</BaseLayout>
